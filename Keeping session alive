def check_executor_filesystem(x):
    import os, sys
    # 1. Get the current environment details
    cwd = os.getcwd()
    path_list = sys.path
    
    # 2. List all files and folders in the working directory
    # We use recursion to see if the files are buried deep
    all_items = []
    for root, dirs, files in os.walk(cwd):
        level = root.replace(cwd, '').count(os.sep)
        indent = ' ' * 4 * (level)
        all_items.append(f"{indent}{os.path.basename(root)}/")
        sub_indent = ' ' * 4 * (level + 1)
        for f in files[:5]: # Limit to 5 files per dir to keep logs clean
            all_items.append(f"{sub_indent}{f}")
            
    return (f"--- EXECUTOR FS MAP ---\n"
            f"CWD: {cwd}\n"
            f"PYTHONPATH: {path_list}\n"
            f"DIRECTORY STRUCTURE:\n" + "\n".join(all_items))

# Trigger the check
report = spark.range(1).rdd.map(check_executor_filesystem).collect()
print(report[0])
