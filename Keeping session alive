import org.apache.spark.sql.SparkSession
import com.mongodb.spark.MongoSpark
import org.bson.Document
import java.time.LocalDate

object MongoDateFilterExample {
  def main(args: Array[String]): Unit = {
    val spark = SparkSession.builder()
      .appName("MongoDB Date Filter")
      .master("local[*]") // Adjust this as per your environment
      .config("spark.mongodb.input.uri", "mongodb://127.0.0.1/test.myCollection") // Replace with your MongoDB URI
      .getOrCreate()

    val currentDate = LocalDate.now().toString

    val pipeline = Seq(
      Document.parse(
        s"""
        {
          $match: {
            dateField: { $eq: ISODate("$currentDate") }
          }
        }
        """
      )
    )

    val df = MongoSpark.load(spark, pipeline)

    df.show()

    spark.stop()
  }
}
